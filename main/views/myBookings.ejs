<link rel="stylesheet" href="/css/myBookings.css">
<script src="/js/myBookings.js" defer></script>
<title>Parking | Foglalásaim</title>
<%- include('layout', {body: '' }) %>

    <!-- #region Dark Mode Toggling Button -->
    <button id="dark-mode-switch" onclick="toggleDarkMode()">
        <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 -960 960 960" width="30px" fill="#1f1f1f">
            <path
                d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Zm0-80q88 0 158-48.5T740-375q-20 5-40 8t-40 3q-123 0-209.5-86.5T364-660q0-20 3-40t8-40q-78 32-126.5 102T200-480q0 116 82 198t198 82Zm-10-270Z" />
        </svg>
    </button>
    <!-- #endregion -->

    <!-- #region Navigation Bar -->
    <nav>
        <a href="/" class="logo">
            <img src="/img/full_logo.png" alt="">
        </a>

        <!-- Nav Items -->
        <div class="items">
            <a href="/">Főoldal</a>
            <a href="#about-us">Rólunk</a>
            <a href="#">Kapcsolat</a>
            <% if (user) {%>
                <a href="/myBookings">Foglalás</a>
            <%} else {%>
                <a style="cursor: pointer;" onclick="alert('Jelentkezz be!')">Foglalás</a>
            <%}%>
        </div>

        <!-- Nav Profile Dropdown -->
        <div class="profile-container">
            <% if (user) {%>
                <h2><%= user.name %></h2>
            <%}%>

            <div class="profile-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="35" height="35" fill="none"
                    stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="32" cy="20" r="12" />
                    <path d="M8 56c0-10.6667 9.6-20 24-20s24 9.3333 24 20" />
                </svg>

                <div class="profile-icon-dropdown-container" tabindex="0">
                    <a href="">Fiókom szerkesztése</a>
                    <% if (user) { %>
                        <a href="/logout">Kijelentkezés</a>
                    <% } else { %>
                        <a href="/login">Bejelentkezés</a>
                    <% } %>
                </div>
            </div>
        </div>

        <!-- Nav Hamburger Menu -->
        <div class="hamburger-menu" onclick="toggleHamburgerMenu()">
            <svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px">
                <path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z" />
            </svg>
        </div>

        <div class="items-vertical">
            <a href="/">Főoldal</a>
            <a href="#about-us">Rólunk</a>
            <a href="#">Kapcsolat</a>
            <% if (user) { %>
            <a href="/myBookings">Foglalás</a>
            <% } else { %>
            <a style="cursor: pointer;" onclick="alert('Jelentkezz be!')">Foglalás</a>
            <% } %>

            <!-- Profile Dropdown -->
            <div class="my-profile" onclick="toggleProfileDropdown()">
                <p>Profil</p>

                <svg id="dropdown-icon" xmlns="http://www.w3.org/2000/svg" height="32px" viewBox="0 -960 960 960"
                    width="32px" fill="var(--primary-text-color)">
                    <path d="M480-344 240-584l56-56 184 184 184-184 56 56-240 240Z" />
                </svg>
            </div>

            <div class="profile-dropdown-conatiner">
                <a href="">Fiókom szerkesztése</a>
                <% if (user) { %>
                    <a href="/logout">Kijelentkezés</a>
                <% } else { %>
                    <a href="/login">Bejelentkezés</a>
                <% } %>
            </div>

        </div>
    </nav>
    <!-- #endregion -->

    <!-- #region My Bookings -->

    <div class="container">
        <h1>Foglalásaim</h1>

        <!-- If user has any bookings, list all booked spaces in a table -->
        <% if (bookings != "") {%>

            <a href="/newBooking" class="add-button">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                    fill="#e3e3e3">
                    <path d="M440-440H200v-80h240v-240h80v240h240v80H520v240h-80v-240Z" />
                </svg>
                Új foglalás hozzáadása
            </a>

            <table>
                <tr>
                    <th>Rendszám</th>
                    <th>Emelet</th>
                    <th>Parkolóhely</th>
                    <th>Mettől</th>
                    <th>Meddig</th>
                    <th>Típus</th>
                    <th>Állapot</th>
                    <th>Törlés</th>
                </tr>

                <% bookings.forEach(booking => { %>
                    <tr>
                        <td>
                            <%= booking["plate_num"] %>
                        </td>
                        <td>
                            <%= booking["floor_num"] %>
                        </td>
                        <td>
                            <%= booking["parking_space_num"] %>
                        </td>
                        <% const date1=new Date(booking["start_time"]); const
                            start_formatted=date1.toISOString().slice(0, 10) + ", " + date1.toISOString().slice(11, 16);
                            %>
                            <td>
                                <%= start_formatted %>
                            </td>
                            <% const date2=new Date(booking["end_time"]); const
                                end_formatted=date2.toISOString().slice(0, 10) + ", " + date2.toISOString().slice(11,
                                16); %>
                                <td>
                                    <%= end_formatted %>
                                </td>
                                <td>
                                    <%= booking["type"] %>
                                </td>
                                <td>
                                    <%= booking["parking_status"] %>
                                </td>
                                <td>
                                    <button class="delete-btn" data-booking-id="<%= booking["id"] %>">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                                            width="24px" fill="#1f1f1f">
                                            <path
                                            d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z" />
                                        </svg>
                                    </button>
                                </td>
                    </tr>
                    <% }) %>
            </table>
            <!-- If user doesn't have any bookings, show message -->
            <% } else {%>
                <h2>Még nincs foglalásod!</h2>

                <a href="/newBooking" class="add-button">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                        fill="#e3e3e3">
                        <path d="M440-440H200v-80h240v-240h80v240h240v80H520v240h-80v-240Z" />
                    </svg>
                    Új foglalás hozzáadása
                </a>
                <% } %>
    </div>


    <!-- #endregion -->